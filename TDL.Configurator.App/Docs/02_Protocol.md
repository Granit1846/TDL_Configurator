# Протокол управления: tdl_send.exe → Named Pipe → SKSE

## Архитектура (как это проходит по цепочке)
1) UI (TDL Configurator) формирует команду.
2) UI запускает `tdl_send.exe` с аргументами.
3) `tdl_send.exe` отправляет сообщение в Windows Named Pipe:
   - `\\.\pipe\TDL_Stream`
4) SKSE‑плагин читает команду и инициирует действие в игре.

Важно: конфигуратор **не управляет игрой напрямую**. Он отправляет заранее определённые ACTION, которые понимает плагин.

---

## Форматы команд (CLI)

### NORMAL (основной режим)
Используйте для большинства действий.

```txt
tdl_send.exe NORMAL <ACTION> [SOURCE]
```

- `ACTION` — идентификатор действия (например `SYSTEM_PING`).
- `SOURCE` — целое число приоритета источника (например 1/2/3). Если не указано, обычно используйте `2`.

Пример:
```txt
tdl_send.exe NORMAL TELEPORT_WHITERUN 2
```

### FORCE1 (одиночный форс)
Обычно обходит часть ограничений и предназначен для ручной отладки/стрима.

```txt
tdl_send.exe FORCE1 <ACTION>
```

Пример:
```txt
tdl_send.exe FORCE1 SYSTEM_HEALING
```

### FORCE (BURST) — серия команд
Используйте осторожно: это нагрузка и риск «сломать сцену», если спамить.

```txt
tdl_send.exe FORCE <ACTION> <COUNT> <INTERVAL> [SOURCE]
```

- `COUNT` — сколько раз выполнить.
- `INTERVAL` — пауза между выполнениями (сек).
- `SOURCE` — приоритет источника (если поддерживается вашей сборкой).

Пример:
```txt
tdl_send.exe FORCE SUMMON_DRAGON 10 1.0 2
```

---

## SOURCE (приоритет источника)
Смысл SOURCE — приоритет/дедупликация событий, когда одновременно работают разные каналы (чат, points, голосование и т.п.).

Рекомендуемые значения:
- `1` — высокий приоритет (например beats)
- `2` — стандартный (по умолчанию)
- `3` — низкий (например vote)

Если вы не уверены — используйте `2`.

---

## Что считать «успехом»
- Команда дошла (pipe доступен) и плагин принял её к обработке.
- Не каждая команда гарантирует видимый эффект:
  - может быть условие по месту/состоянию (combat, меню, анимация, сцена),
  - может сработать защита/кулдаун,
  - в режиме FORCE могут действовать лимиты из `TDL_Cooldowns.ini`.

Если команда «не видна» — начинайте с SYSTEM_PING и смотрите документ 11 (логи).

---

## Мини‑правила безопасности
- Не запускайте тяжёлые BURST‑серии в маленьких интервалах (см. 04_FORCE_Safety.md).
- Для телепортов избегайте `COUNT > 3` и `INTERVAL < 5.0` — высокий риск сломать квестовые сцены/AI.

## См. также
- 03_ActionCatalog_NORMAL.md — перечень команд (обзор).
- 09_ActionReference.md — человеческие описания ключевых ACTION.
- 04_FORCE_Safety.md — безопасные пределы и «что делать если пошло не так».
